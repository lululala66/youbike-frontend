<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è‡ºä¸­å¸‚ YouBike å³æ™‚è³‡è¨Š</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <h1>è‡ºä¸­å¸‚ YouBike å³æ™‚è³‡è¨Š</h1>

  <!-- é ç±¤åˆ‡æ› -->
  <div class="tabs">
    <button class="tab-button active" data-target="tab-info">ç«™é»è³‡è¨Š</button>
    <button class="tab-button" data-target="tab-route">è·¯ç·šè¦åŠƒ</button>
  </div>

  <!-- ç«™é»è³‡è¨Šé ç±¤ -->
  <div id="tab-info" class="tab-content" style="display: block;">
    <form id="searchForm" method="GET" autocomplete="off">
      <label>
        é¸æ“‡ç¸£å¸‚ï¼š
        <select name="city" id="citySelect">
          {% for c in cities %}
            <option value="{{ c }}" {% if c == city %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
      </label>

      <div class="districts">
        {% for d in districts %}
          <button type="button" class="district-btn {% if d in selected %}selected{% endif %}" data-district="{{ d }}">
            {{ d }}
          </button>
          {% if d in selected %}
            <input type="hidden" name="district" value="{{ d }}">
          {% endif %}
        {% endfor %}
      </div>

      <label class="input-wrapper">
        ğŸ” æŸ¥è©¢ç«™é»ï¼š
        <input type="text" id="stationInput" name="station" placeholder="è«‹è¼¸å…¥ç«™é»åç¨±" autocomplete="off">
        <div id="suggestions"></div>
      </label>

      <button type="submit">æŸ¥è©¢</button>
    </form>

    {% if stations %}
      <div class="station-window">
        <table>
          <thead>
            <tr>
              <th>ç¸£å¸‚</th>
              <th>å€åŸŸ</th>
              <th>ç«™é»åç¨±</th>
              <th>å¯å€Ÿè»Šè¼›</th>
              <th>å¯åœç©ºä½</th>
            </tr>
          </thead>
          <tbody>
            {% for s in stations %}
              <tr>
                <td>{{ s.city }}</td>
                <td>{{ s.district }}</td>
                <td class="highlight">{{ s.station_name }}</td>
                <td>{{ s.bikes_available }}</td>
                <td>{{ s.docks_available }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>

  <!-- è·¯ç·šè¦åŠƒé ç±¤ -->
  <div id="tab-route" class="tab-content">
    <form id="route-form">
      <label>
        èµ·é»ç«™é»ï¼š
        <input type="text" id="start" placeholder="è¼¸å…¥èµ·é»">
      </label>
      <label>
        ç›®çš„ç«™é»ï¼š
        <input type="text" id="end" placeholder="è¼¸å…¥çµ‚é»">
      </label>
      <button type="button" id="plan-route-btn">é–‹å§‹è¦åŠƒè·¯ç·š</button>
    </form>
    <div id="map"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const districtButtons = document.querySelectorAll(".district-btn");
      districtButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const district = btn.dataset.district;
          btn.classList.toggle("selected");

          const existingInput = document.querySelector(`input[name="district"][value="${district}"]`);
          if (btn.classList.contains("selected")) {
            if (!existingInput) {
              const input = document.createElement("input");
              input.type = "hidden";
              input.name = "district";
              input.value = district;
              document.getElementById("searchForm").appendChild(input);
            }
          } else {
            if (existingInput) existingInput.remove();
          }
        });
      });
    });
  </script>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
